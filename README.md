# CrudoDb

typescript written offline first indexeddb wrapper.

is able to sync with backend services by passing optional service implementation.

## why?

CrudoDb offers some advantages over other solutions.

CrudoDb offers an offline-first and offline-only solution.

An API connection is optional and can be synchronized e.g. after an already completed offline implementation.

## crudodb

store list of `Database<T>` instances and manage them.

`schemaKey` is an identifier to the instance of `Database<T>` you want to access.

for example:

```typescript
const instance = await CrudoDb.setup();

// key will generated by CrudoDb
const key = await wrapper.registerDatabase({
    schema: mySchema
});
const item: T = {key: 'value', id: '1'};

// will call create of the Database<T> instance
wrapper.create(key, item);
```

## database

manage all CRUD operations against store and optional api.

store item in indexeddb and on success try to call the api#create.

if no api defined, the item only lives in the indexeddb.

if api defined, the created item will send to api.

on successful creation, the local item will update without creation flag.

### flags

there are 3 flags to mark an item in indexeddb for processing.

+ C
+ U
+ D


## recommendations

### angular

```typescript
@Injectable({providedIn: 'root'})
export class StoreAccessService {

    public instance$ = fromPromise(CrudoDb.setup)
        .pipe(shareReplay(1));

}

@Injectable({providedIn: 'root'})
export class DaoService {

    private key$ = this.storeAccess.instance$.pipe(
        switchMap((instance) => instance.registerSchema({schema})),
        shareReplay(1)
    );

    private handle$ = combineLatest([this.key$, this.storeAccess.instance$]).pipe(shareReplay(1));

    constructor(private storeAccess: StoreAccessService) {}

    public create(item: Dao): Observable<Dao> {
        return this.handle$.pipe(
            switchMap(([key, instance]) => instance.create(key, item))
        );
    }
}

```

### react (hooks)

```typescript jsx

// TODO: write hook(context) for it

 
```
